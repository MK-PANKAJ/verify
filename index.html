<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate Verification</title>
    <style>
        /* Basic Page Reset & Layout */
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        /* Enhancing the user's inline styles slightly for the demo page */
        #hf-verification-app {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* Hover effect for the verify button */
        #hf-verification-app button:hover {
            background-color: #218838 !important;
        }

        /* Hover effect for the download link */
        #hf-download:hover {
            text-decoration: underline !important;
        }
    </style>
</head>

<body>

    <!-- BEGIN: Verification Widget Code -->
    <div id="hf-verification-app" style="width: 100%; max-width: 600px; margin: 0 auto; font-family: sans-serif;">
        <div id="hf-search-box" style="text-align: center;">
            <h3 style="margin-top: 0; color: #333;">Verify Certificate</h3>
            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <input type="text" id="hf-cert-input" placeholder="Certificate ID (e.g., HF-2024-1234)"
                    style="padding: 10px; flex: 1; min-width: 200px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px;">
                <button onclick="hfVerifyCert()"
                    style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; transition: background 0.2s;">
                    Verify
                </button>
            </div>
        </div>

        <!-- Results Container -->
        <div id="hf-result-card"
            style="display: none; margin-top: 20px; border: 1px solid #eee; padding: 20px; border-radius: 8px; background: #fdfdfd; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
            <div id="hf-status-message"
                style="font-weight: bold; font-size: 18px; margin-bottom: 15px; text-align: center;"></div>
            <div id="hf-cert-details" style="display: none; line-height: 1.6; color: #444;">
                <p style="margin: 8px 0; border-bottom: 1px solid #eee; padding-bottom: 8px;">
                    <strong style="color: #333;">Name:</strong> <span id="hf-name" style="float: right;"></span>
                </p>
                <p style="margin: 8px 0; border-bottom: 1px solid #eee; padding-bottom: 8px;">
                    <strong style="color: #333;">Course:</strong> <span id="hf-course" style="float: right;"></span>
                </p>
                <p style="margin: 8px 0; border-bottom: 1px solid #eee; padding-bottom: 8px;">
                    <strong style="color: #333;">Date:</strong> <span id="hf-date" style="float: right;"></span>
                </p>
                <div style="text-align: center; margin-top: 20px;">
                    <button disabled id="hf-email-btn" onclick="hfEmailCert()"
                        style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">
                        üìß Email Me a Copy
                    </button>
                    <div id="hf-email-msg" style="margin-top: 10px; font-size: 13px; color: #666;"></div>
                </div>
            </div>

            <script>
                (function () {
                    // CONFIGURATION
                    // Ensure this matches your deployed backend URL
                    const API_BASE = "https://certificate-verification-woce.onrender.com/api/public/verify/";

                    window.hfVerifyCert = async function () {
                        const input = document.getElementById('hf-cert-input');
                        const resultCard = document.getElementById('hf-result-card');
                        const statusMsg = document.getElementById('hf-status-message');
                        const details = document.getElementById('hf-cert-details');
                        const id = input.value.trim();

                        if (!id) {
                            alert("Please enter a Certificate ID");
                            return;
                        }

                        // Reset UI
                        resultCard.style.display = 'block';
                        statusMsg.innerText = "Verifying...";
                        statusMsg.style.color = "#666";
                        details.style.display = 'none';

                        try {
                            const response = await fetch(API_BASE + id);
                            const data = await response.json();

                            if (data.valid) {
                                statusMsg.innerHTML = "‚úÖ Verified Authentic";
                                statusMsg.style.color = "#28a745";

                                // Update fields
                                document.getElementById('hf-name').innerText = data.candidateName || "N/A";
                                document.getElementById('hf-course').innerText = data.position || "N/A";

                                // Handle Date formatting if string is provided
                                const dateStr = data.issueDate || "";
                                document.getElementById('hf-date').innerText = dateStr.split('T')[0]; // Simple formatting

                                // document.getElementById('hf-download').href = data.cloudinaryUrl; // Removed
                                details.style.display = 'block';
                            } else {
                                throw new Error(data.message || "Invalid Certificate");
                            }
                        } catch (error) {
                            console.error(error);
                            statusMsg.innerHTML = "‚ùå Verification Failed";
                            statusMsg.style.color = "#dc3545";

                            // Optional: Show specific error message
                            if (error.message && error.message !== "Invalid Certificate") {
                                const errorDetail = document.createElement('div');
                                errorDetail.style.fontSize = "12px";
                                errorDetail.style.marginTop = "5px";
                                errorDetail.innerText = "Certificate ID not found or invalid.";
                                statusMsg.appendChild(errorDetail);
                            }

                            details.style.display = 'none';
                        }
                    };

                    window.hfEmailCert = async function () {
                        const id = document.getElementById('hf-cert-input').value.trim();
                        const btn = document.getElementById('hf-email-btn');
                        const msg = document.getElementById('hf-email-msg');

                        if (!id) return;

                        btn.disabled = true;
                        btn.innerText = "Sending...";
                        msg.innerText = "";

                        try {
                            const response = await fetch("https://certificate-verification-woce.onrender.com/api/public/resend-email/" + id, { method: 'POST' });
                            const data = await response.json();

                            if (data.success) {
                                msg.innerText = data.message;
                                msg.style.color = "green";
                                btn.innerText = "Sent!";
                            } else {
                                throw new Error(data.message || "Failed to send");
                            }
                        } catch (error) {
                            console.error(error);
                            msg.innerText = "Error: " + (error.message || "Could not send email.");
                            msg.style.color = "red";
                            btn.innerText = "Try Again";
                            btn.disabled = false;
                        }
                    };

                    // Allow pressing "Enter" key to verify
                    document.getElementById('hf-cert-input').addEventListener('keypress', function (e) {
                        if (e.key === 'Enter') {
                            window.hfVerifyCert();
                        }
                    });
                })();
            </script>
            <!-- END: Verification Widget Code -->

</body>

</html>
